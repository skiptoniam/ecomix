<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Species Archetype Model Example • ecomix</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Species Archetype Model Example">
<meta property="og:description" content="ecomix">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ecomix</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/RCP-example.html">Region of Common Profiles Example</a>
    </li>
    <li>
      <a href="../articles/SAM-example.html">Species Archetype Model Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/skiptoniam/ecomix/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="SAM-example_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Species Archetype Model Example</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/skiptoniam/ecomix/blob/master/vignettes/SAM-example.Rmd"><code>vignettes/SAM-example.Rmd</code></a></small>
      <div class="hidden name"><code>SAM-example.Rmd</code></div>

    </div>

    
    
<div id="species-archetype-models" class="section level3">
<h3 class="hasAnchor">
<a href="#species-archetype-models" class="anchor"></a>Species Archetype Models</h3>
<p>The Species Archetype Models (SAMs) are variant of ‘Mixture-of-Regressions’ and try to describe how homogeneous groups of <strong>species</strong> vary with the environment. These groups are referred to as Species Archetypes <span class="citation">(Dunstan <em>et al.</em> 2011)</span>. Each Archetype represents a group of species which jointly response to environmental data in the model (covariates). For example, one group of species might like warm water, while another might like cold. Typically, we model observations of species at sites. The covariates are used to describe the variation (and response) of each Archetype to the physical and environmental gradients. We can describe the data as <span class="math inline">\(i = 1...n\)</span> sampling sites, <span class="math inline">\(j = 1...S\)</span> species (or desired taxonomic unit) and <span class="math inline">\(k = 1...K\)</span> Archetypes. The model conditional mean observations (occurrence/count/biomass) of species is, <span class="math inline">\(\mathbb{E}(y_{ij}|\textrm{z}_{k})\)</span>, on <span class="math inline">\(g_{k}(X_i)\)</span> Archetype covariates. In <code>ecomix</code>, the intercepts are species-specific, this is an update from the original ‘SpeciesMix’ R package <span class="citation">(Dunstan <em>et al.</em> 2013a)</span>, where the intercepts were only species-specific for the Negative Binomial and Tweedie distributions, as described in <span class="citation">Dunstan <em>et al.</em> (2013b)</span>. For error distributions with dispersion or variance parameters (Negative Binomial, Tweedie and Gaussian) these parameters are also species-specific. The model can be described as follows:</p>
<p><span class="math display">\[
\begin{equation}
h[\mathbb{E}(y_{ij}|z_{k})] = \alpha_j + g_k(X_{i}^\top\beta_{k}) + \nu_i \tag{1}\label{eq:one}
\end{equation}
\]</span></p>
<p>where <span class="math inline">\(Pr(z_{k}) = \pi_k,\)</span> and <span class="math inline">\(\sum^K_{k=1}{\pi_k=1}\)</span>. The functional form of <span class="math inline">\(g_k(.)\)</span> can be specified to be any function commonly used within a Generalized Linear Model framework. Including linear, quadratic, spline and interaction terms. Additionally an offset term <span class="math inline">\(\nu_i\)</span> can be included to account for sampling artefacts and are included into the model on a log-scale (e.g. log(area sampled)). We refer to the model as the <code>species_mix</code> in the <code>ecomix</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/skiptoniam/ecomix">ecomix</a></span><span class="op">)</span></code></pre></div>
<p>Here we will demonstrate how to fit and interpret a Species Archetype Models (SAMs) from our <code>ecomix</code> package. We will present a simulation study to demonstrate the functionality of <code>species_mix</code>.</p>
<div id="simulate-environmental-data" class="section level4">
<h4 class="hasAnchor">
<a href="#simulate-environmental-data" class="anchor"></a>Simulate Environmental Data</h4>
<p>We generate a set of simulated environment predictors using Gaussian random fields with nugget effects on some of the variables.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster">raster</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ms.math.uni-mannheim.de/de/publications/software/randomfields">RandomFields</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">007</span><span class="op">)</span>
<span class="va">lenny</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">xSeq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span> from<span class="op">=</span><span class="fl">0</span>, to<span class="op">=</span><span class="fl">1</span>, length<span class="op">=</span><span class="va">lenny</span><span class="op">)</span>
<span class="va">ySeq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span> from<span class="op">=</span><span class="fl">0</span>, to<span class="op">=</span><span class="fl">1</span>, length<span class="op">=</span><span class="va">lenny</span><span class="op">)</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span> x<span class="op">=</span><span class="va">xSeq</span>, y<span class="op">=</span><span class="va">ySeq</span><span class="op">)</span>
<span class="va">Mod1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RMgauss.html">RMgauss</a></span><span class="op">(</span> var<span class="op">=</span><span class="fl">1</span>, scale<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RMnugget.html">RMnugget</a></span><span class="op">(</span> var<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>
<span class="va">Mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RMgauss.html">RMgauss</a></span><span class="op">(</span> var<span class="op">=</span><span class="fl">1</span>, scale<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RMnugget.html">RMnugget</a></span><span class="op">(</span> var<span class="op">=</span><span class="fl">0.01</span><span class="op">)</span>
<span class="va">Mod3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RMgauss.html">RMgauss</a></span><span class="op">(</span> var<span class="op">=</span><span class="fl">1</span>, scale<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="co"># + RMnugget( var=0.01)</span>
<span class="va">Mod4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RMgauss.html">RMgauss</a></span><span class="op">(</span> var<span class="op">=</span><span class="fl">2</span>, scale<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RMnugget.html">RMnugget</a></span><span class="op">(</span> var<span class="op">=</span><span class="fl">1</span><span class="op">)</span>
<span class="va">simmy1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RFsimulate.html">RFsimulate</a></span><span class="op">(</span> <span class="va">Mod1</span>, x<span class="op">=</span><span class="va">xSeq</span>, y<span class="op">=</span><span class="va">ySeq</span><span class="op">)</span>
<span class="va">simmy2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RFsimulate.html">RFsimulate</a></span><span class="op">(</span> <span class="va">Mod2</span>, x<span class="op">=</span><span class="va">xSeq</span>, y<span class="op">=</span><span class="va">ySeq</span><span class="op">)</span>
<span class="va">simmy3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RFsimulate.html">RFsimulate</a></span><span class="op">(</span> <span class="va">Mod3</span>, x<span class="op">=</span><span class="va">xSeq</span>, y<span class="op">=</span><span class="va">ySeq</span><span class="op">)</span>
<span class="va">simmy4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/RFsimulate.html">RFsimulate</a></span><span class="op">(</span> <span class="va">Mod4</span>, x<span class="op">=</span><span class="va">xSeq</span>, y<span class="op">=</span><span class="va">ySeq</span><span class="op">)</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span> <span class="va">X</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span> <span class="va">simmy1</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span> <span class="va">simmy2</span><span class="op">)</span><span class="op">)</span>,
            <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span> <span class="va">simmy3</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span> <span class="va">simmy4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">X</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span> <span class="va">X</span><span class="op">[</span>,<span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span>, <span class="fl">2</span>, <span class="va">scale</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span> <span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="st">"x"</span>,<span class="st">"y"</span>,<span class="st">"covar1"</span>,<span class="st">"covar2"</span>,<span class="st">"covar3"</span>,<span class="st">"covar4"</span><span class="op">)</span>
<span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterFromXYZ.html">rasterFromXYZ</a></span><span class="op">(</span> <span class="va">X</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/names.html">names</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="st">"Temperature"</span>, <span class="st">"Oxygen"</span>, <span class="st">"Depth"</span>, <span class="st">"Productivity"</span><span class="op">)</span>
<span class="va">env.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">env</span>,xy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="va">env_dat</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rasterToPoints.html">rasterToPoints</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="SAM-example_files/figure-html/env%20plots-1.png" alt="Figure 1. Simulated environmental variables used in Species Archetype Modelling" width="384"><p class="caption">
Figure 1. Simulated environmental variables used in Species Archetype Modelling
</p>
</div>
</div>
<div id="simulate-biological-data" class="section level4">
<h4 class="hasAnchor">
<a href="#simulate-biological-data" class="anchor"></a>Simulate Biological Data</h4>
<p>We simulated a set of synthetic species to be fitted using the <code>species_mix</code> function. We generated the expected species intercepts <span class="math inline">\(\alpha_j\)</span> from a beta distribution, and assign known group level covariates <span class="math inline">\(\beta_k\)</span>. <span class="math inline">\(\beta_k\)</span> represents the archetype (group) response to each covariate in the model. We simulated species archetypical responses using the <code>species_mix.simulate</code> function. If no known parameters are provided random parameters will be generated for the formula and data provided. Here we provided parameters for the species intercepts (alphas) and the archetype mean responses (betas).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span>
<span class="va">nsp</span> <span class="op">&lt;-</span> <span class="fl">100</span>
<span class="va">betamean</span> <span class="op">&lt;-</span> <span class="fl">0.3</span>
<span class="va">betabeta</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">betaalpha</span> <span class="op">&lt;-</span> <span class="va">betamean</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">betamean</span><span class="op">)</span> 
<span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span> <span class="va">nsp</span>, <span class="va">betaalpha</span>, <span class="va">betabeta</span><span class="op">)</span> 
<span class="va">alphas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">log</a></span><span class="op">(</span> <span class="va">alpha</span> <span class="op">/</span> <span class="op">(</span> <span class="fl">1</span><span class="op">-</span><span class="va">alpha</span><span class="op">)</span><span class="op">)</span>  

<span class="va">betas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Temperature<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="fl">0.75</span>,<span class="fl">0</span>,<span class="fl">1.5</span><span class="op">)</span>,
                              Temperature2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.75</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
                              Oxygen<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span>,
                              Oxygen2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span>,
                              Depth<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1.5</span>,<span class="fl">0.5</span>,<span class="fl">1.5</span><span class="op">)</span>,
                              Depth2<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="op">-</span><span class="fl">0.5</span>,<span class="fl">0</span><span class="op">)</span>,
                              Productivity<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="op">-</span><span class="fl">2.5</span><span class="op">)</span>,
                              Productivity2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,
                              Time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">betas</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Archetype."</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>

<span class="co"># generate realisation of data for entire survey region</span>
<span class="va">sim_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>intercept<span class="op">=</span><span class="fl">1</span>,<span class="va">env_dat</span><span class="op">[</span>,<span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">ncol</a></span><span class="op">(</span><span class="va">env_dat</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>
<span class="va">sites</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html">nrow</a></span><span class="op">(</span><span class="va">sim_dat</span><span class="op">)</span>, <span class="fl">200</span>, replace<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="va">env_200</span><span class="op">&lt;-</span><span class="va">sim_dat</span><span class="op">[</span><span class="va">sites</span>,<span class="op">]</span>
<span class="va">env_200</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,size <span class="op">=</span> <span class="fl">200</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">sam_form</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'cbind('</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'spp'</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span>,
collapse <span class="op">=</span> <span class="st">','</span><span class="op">)</span>,<span class="st">")~poly(Temperature,degree=2,raw=TRUE)+poly(Oxygen,degree=2,raw=TRUE)+poly(Depth,degree=2,raw=TRUE)+poly(Productivity,degree=2,raw=TRUE)+Time"</span><span class="op">)</span><span class="op">)</span>
<span class="va">sp_form</span> <span class="op">&lt;-</span> <span class="op">~</span><span class="fl">1</span>
<span class="va">simulated_data200</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/species_mix.simulate.html">species_mix.simulate</a></span><span class="op">(</span>archetype_formula<span class="op">=</span><span class="va">sam_form</span>,
                                       species_formula<span class="op">=</span><span class="va">sp_form</span>,
                                       alpha <span class="op">=</span> <span class="va">alphas</span>,
                                       beta <span class="op">=</span> <span class="va">betas</span>,
                                       data <span class="op">=</span> <span class="va">env_200</span>,
                                       nArchetypes <span class="op">=</span> <span class="fl">3</span>,
                                       family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="model-fitting-and-evaluation" class="section level4">
<h4 class="hasAnchor">
<a href="#model-fitting-and-evaluation" class="anchor"></a>Model fitting and evaluation</h4>
<p>We have generated occurrence records for 100 synthetic species across the 200 randomly surveyed sites. Because we have presence and absence data we can fit a SAM with a Bernoulli family. In this example, we may chose to remove the rare species (&lt; 10 occurrences across all sites). These species could be potentially included in the model, but would likely create noise and unexplained variance, making the model harder to fit and estimate <span class="citation">(Hui <em>et al.</em> 2013)</span>.</p>
<div class="figure">
<img src="SAM-example_files/figure-html/unnamed-chunk-4-1.png" alt="Figure 2. The simulated occurrences for the 100 species. We will remove all species with less than 10 presences across all 200 sites. " width="700"><p class="caption">
Figure 2. The simulated occurrences for the 100 species. We will remove all species with less than 10 presences across all 200 sites.
</p>
</div>
<p>In this, example we fit independent polynomials with two degrees of freedom for the four simulated covariates Temperature, Oxygen, Depth &amp; Productivity. We do this to demonstrate a simple simulated example where can show the known response of covariates to simulated data. We include time as a factor, which represents the time in which the simulated samples were recorded, for these data the two factors are ‘Day’ or ‘Night’. But additional discrete times could be included such as years. Below is a small code block with a basic example on how to fit a single species_mix model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## load the ecomix package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/skiptoniam/ecomix">ecomix</a></span><span class="op">)</span>
 
<span class="co">## Select species with greater than ten occurrences across all sites.</span>
<span class="va">spdata</span> <span class="op">&lt;-</span> <span class="va">simulated_data200</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span> 
<span class="va">spdata</span> <span class="op">&lt;-</span> <span class="va">spdata</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html">colSums</a></span><span class="op">(</span><span class="va">simulated_data200</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">]</span><span class="op">)</span><span class="op">&lt;</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span> 
<span class="va">samdat_10p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">spdata</span>,<span class="va">env_200</span><span class="op">)</span>
<span class="va">samdat_10p</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/factor.html">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">samdat_10p</span><span class="op">$</span><span class="va">Time</span><span class="op">&gt;</span><span class="fl">0</span>,<span class="st">"Night"</span>,<span class="st">"Day"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Archetype formula</span>
<span class="va">archetype_formula</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html">as.formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'cbind('</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">samdat_10p</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grep</a></span><span class="op">(</span><span class="st">"spp"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">samdat_10p</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,collapse <span class="op">=</span> <span class="st">", "</span><span class="op">)</span>,<span class="st">") ~ poly(Temperature,degree=2,raw=TRUE)+poly(Oxygen,degree=2,raw=TRUE)+poly(Depth,degree=2,raw=TRUE)+poly(Productivity,degree=2,raw=TRUE)+Time"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Species formula</span>
<span class="va">species_formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="fl">1</span>

<span class="co">## Fit a single model</span>
<span class="va">sam_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/species_mix.html">species_mix</a></span><span class="op">(</span>archetype_formula <span class="op">=</span> <span class="va">archetype_formula</span>, <span class="co"># Archetype formula</span>
                       species_formula <span class="op">=</span> <span class="va">species_formula</span>,    <span class="co"># Species formula</span>
                       data <span class="op">=</span> <span class="va">samdat_10p</span>,            <span class="co"># Data</span>
                       nArchetypes <span class="op">=</span> <span class="fl">3</span>,              <span class="co"># Number of groups (mixtures) to fit</span>
                       family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span>,         <span class="co"># Which family to use</span>
                       control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="group-selection" class="section level4">
<h4 class="hasAnchor">
<a href="#group-selection" class="anchor"></a>Group selection</h4>
<p>One challenge when developing SAMs (or any finite mixture model) is selecting <span class="math inline">\(k\)</span>; the number of archetypes (groups) in the model. The number of archetypes is latent, so must be estimated from the data and the functional form of the covariates. In this example, we know that the optimal number of groups for these data is three, because we simulated the data with these characteristics. However, <span class="math inline">\(k\)</span> is generally not known in real world applications. So one import part of the fitting process is finding <span class="math inline">\(k\)</span>, having said that it is also totally fine to define <span class="math inline">\(k\)</span> for say a management objective. We can estimate the “best” number of groups based on the most parsimonious fit to the data. We can do this based on the model log-likelihood, and information criterion such as BIC. We provide a function <code>species_mix.multifit</code> which can assist in group selection if a vector of archetypes is provided. Below is an example of how one might do this. For simplicity we have left the <code>nstart=1</code>, but for more complex models this could be increased to use multiple starts to help search to the likelihood.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nArchetypes</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>
<span class="va">sam_multifit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/species_mix.multifit.html">species_mix.multifit</a></span><span class="op">(</span>archetype_formula <span class="op">=</span> <span class="va">archetype_formula</span>, <span class="co"># Archetype formula</span>
                                     species_formula <span class="op">=</span> <span class="va">species_formula</span>,     <span class="co"># Species formula</span>
                                     data <span class="op">=</span> <span class="va">samdat_10p</span>,                     <span class="co"># Data</span>
                                     nArchetypes <span class="op">=</span> <span class="va">nArchetypes</span>,             <span class="co"># Number of groups (mixtures) to fit</span>
                                     nstart <span class="op">=</span> <span class="fl">1</span>,                            <span class="co"># The number of fits per archetype.</span>
                                     family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span><span class="op">)</span>,                  <span class="co"># Which family to use</span>
                                     control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Initialising starting values</span>
<span class="co">#&gt; Initial groups parameter estimates by K-means clustering with random noise</span>
<span class="co">#&gt; Initialising starting values</span>
<span class="co">#&gt; Initial groups parameter estimates by K-means clustering with random noise</span>
<span class="co">#&gt; Initialising starting values</span>
<span class="co">#&gt; Initial groups parameter estimates by K-means clustering with random noise</span>
<span class="co">#&gt; Initialising starting values</span>
<span class="co">#&gt; Initial groups parameter estimates by K-means clustering with random noise</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">sam_multifit</span>,type<span class="op">=</span><span class="st">"BIC"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="SAM-example_files/figure-html/unnamed-chunk-7-1.png" alt="Figure 4. BIC from species archetype model fits per group." width="768"><p class="caption">
Figure 4. BIC from species archetype model fits per group.
</p>
</div>
</div>
<div id="model-diagnostics-and-checking" class="section level4">
<h4 class="hasAnchor">
<a href="#model-diagnostics-and-checking" class="anchor"></a>Model diagnostics and checking</h4>
<p>Once we selected the ‘best’ model we can start to explore the model fit via diagnostics and checks. Typically, we would look at the model residuals to understand the model diagnostics <span class="citation">(Warton <em>et al.</em> 2015)</span>. Here we present the random quantile residuals <span class="citation">(Dunn &amp; Smyth 1996)</span> versus the fitted values from the model. We can see the residuals, presented on a species by species level, are approximately randomly distributed along the fitted line, which suggests nothing is untoward with the model fit.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">sam_fit</span>,fitted.scale <span class="op">=</span> <span class="st">'logit'</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="SAM-example_files/figure-html/unnamed-chunk-8-1.png" alt="Figure 5. Random quantile residuals for all species in the fitted model." width="768"><p class="caption">
Figure 5. Random quantile residuals for all species in the fitted model.
</p>
</div>
<p>We can also look at the random quantile residuals for a single species</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="va">sam_fit</span>,fitted.scale <span class="op">=</span> <span class="st">'logit'</span>, species<span class="op">=</span><span class="st">"spp3"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="SAM-example_files/figure-html/unnamed-chunk-9-1.png" alt="Figure 6. Random quantile residuals for spp3 from the fitted model." width="768"><p class="caption">
Figure 6. Random quantile residuals for spp3 from the fitted model.
</p>
</div>
<p>We can also plot the partial responses of covariates as shown in <span class="citation">Dunstan <em>et al.</em> (2011)</span> &amp; <span class="citation">Hui <em>et al.</em> (2013)</span>. The idea behind this approach is to understand the response of archetypes to a focal predictor. Firstly, we need to set up a data.frame which allows the focal.predictor to vary and averages over the other effects in the model. We demonstrate how to this in the next code chunk. We can include estimates of uncertainty in the partial response plots by including a bootstrap object into the plot function, otherwise the mean response is plotted without uncertainty in the partial response.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">eff.df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/effect_data.html">effects_data</a></span><span class="op">(</span>focal.predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="st">"Temperature"</span>,<span class="st">"Oxygen"</span>,<span class="st">"Productivity"</span>,<span class="st">"Depth"</span>,<span class="st">"Time"</span><span class="op">)</span>, <span class="va">sam_fit</span><span class="op">)</span>
<span class="va">sam_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bootstrap.html">bootstrap</a></span><span class="op">(</span><span class="va">sam_fit</span>,nboot <span class="op">=</span> <span class="fl">10</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; ..........</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">eff.df</span>, object <span class="op">=</span> <span class="va">sam_fit</span>, object2<span class="op">=</span><span class="va">sam_boot</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/RandomFields/man/QMath.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="SAM-example_files/figure-html/partial%20plots-1.png" alt="Figure 6. Partial response plots for each covariate in the model." width="576"><p class="caption">
Figure 6. Partial response plots for each covariate in the model.
</p>
</div>
</div>
<div id="model-prediction" class="section level4">
<h4 class="hasAnchor">
<a href="#model-prediction" class="anchor"></a>Model prediction</h4>
<p>We can generate predictions for the each archetype in ecomix using <code><a href="https://rdrr.io/pkg/raster/man/predict.html">predict()</a></code> function. The default is used to generate a point mean estimate for each archetype. With the inclusion of a <code>bootstrap</code> object we can also provide estimates of uncertainty or standard error for each prediction. We can see spatial predict the point mean and standard error in the predicted distributions of each archetype (Fig. 3e &amp; 3f). We can also see the spatial response of each archetype is strongly correlated to it’s environmental response to each covariate (Fig. 2). For example, archetype two has a strong response to depth (Fig. 3e), which is evident in the archetype responses (Fig. 3d).</p>
<div class="figure">
<img src="SAM-example_files/figure-html/archetype%20predictions-1.png" alt="Figure 8. The predicted probability of each species archetype across the simulated environment and the standard error of the predictions generated based on the Bayesian bootstrap." width="384"><p class="caption">
Figure 8. The predicted probability of each species archetype across the simulated environment and the standard error of the predictions generated based on the Bayesian bootstrap.
</p>
</div>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-dunn_randomized_1996" class="csl-entry">
Dunn, P.K. &amp; Smyth, G.K. (1996). Randomized <span>Quantile</span> <span>Residuals</span>. <em>Journal of Computational and Graphical Statistics</em>, <strong>5</strong>, 236.
</div>
<div id="ref-dunstan_model_2011" class="csl-entry">
Dunstan, P.K., Foster, S.D. &amp; Darnell, R. (2011). Model based grouping of species across environmental gradients. <em>Ecological Modelling</em>, <strong>222</strong>, 955–963.
</div>
<div id="ref-dunstan_speciesmix_2013" class="csl-entry">
Dunstan, P., Foster, S. &amp; Darnell, R. (2013a). <span>SpeciesMix</span>: <span>Fit</span> mixtures of archetype species. <em>R package version 0.3</em>, <strong>1</strong>.
</div>
<div id="ref-dunstan_finite_2013" class="csl-entry">
Dunstan, P.K., Foster, S.D., Hui, F.K. &amp; Warton, D.I. (2013b). Finite mixture of regression modeling for high-dimensional count and biomass data in ecology. <em>Journal of agricultural, biological, and environmental statistics</em>, <strong>18</strong>, 357–375.
</div>
<div id="ref-hui_mix_2013" class="csl-entry">
Hui, F.K., Warton, D.I., Foster, S.D. &amp; Dunstan, P.K. (2013). To mix or not to mix: Comparing the predictive performance of mixture models vs. Separate species distribution models. <em>Ecology</em>, <strong>94</strong>, 1913–1919.
</div>
<div id="ref-warton_model-based_2015" class="csl-entry">
Warton, D.I., Foster, S.D., De’ath, G., Stoklosa, J. &amp; Dunstan, P.K. (2015). Model-based thinking for community ecology. <em>Plant Ecology</em>, <strong>216</strong>, 669–682.
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Skipton Woolley, Scott Foster, Piers Dunstan.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
